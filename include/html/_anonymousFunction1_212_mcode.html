<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type0" id="S2T0U3">gram_matrix_update</span>,<span class="var type0" id="S3T0U4">y_star</span>,<span class="var type0" id="S4T0U5">cov_star</span>,<span class="var type0" id="S5T0U6">X_update</span>,<span class="var type0" id="S6T0U7">Y_update</span>,<span class="var type0" id="S7T0U8">K_update</span> ] = onlineGPR( <span class="var type0" id="S8T0U11">x</span>,<span class="var type0" id="S9T0U12">y</span>,<span class="var type0" id="S10T0U13">x_star</span>,<span class="var type0" id="S11T0U14">gram_matrix</span>,<span class="var type0" id="S12T0U15">X</span>,<span class="var type0" id="S13T0U16">Y</span>,<span class="var type0" id="S14T0U17">K</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%ONLINEGPR Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line">    <span class="comment">% The max size of gram matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line">    <span class="var type0" id="S15T0U20">MAX_SIZE</span> = 100;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line">    <span class="comment">% Kernel function</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line">    <span class="var type0" id="S16T0U24">L</span> = 0.6;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line">    <span class="var type0" id="S17T0U28">Kfn</span> = <span class="mxinfo " id="T32:U1">@(<span class="mxinfo " id="T4:U2">x</span>,<span class="mxinfo " id="T6:U3">z</span>) <span class="mxinfo " id="T16:U4"><span class="mxinfo " id="T3:U5">1</span>*<span class="mxinfo " id="T16:U6">exp(<span class="mxinfo " id="T16:U7"><span class="mxinfo " id="T16:U8"><span class="mxinfo " id="T3:U9">-0.5</span>*<span class="mxinfo " id="T16:U10"><span class="fcn" id="F192N8:B41">sq_dist</span>(<span class="mxinfo " id="T4:U11">x</span>,<span class="mxinfo " id="T6:U12">z</span>)</span></span>/(<span class="var type1" id="S16T3U46">L</span>^2)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line">    <span class="var type0" id="S20T0U50">keps</span> = 1e-3;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line">    <span class="var type0" id="S21T0U54">gram_size</span> = length(<span class="var type0" id="S11T0U57">gram_matrix</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="comment">%     % If it is the first time we compute gram marix and return</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="comment">%     if(gram_size == 0)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="comment">%         X_update = x;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="comment">%         Y_update = y;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="comment">%         K_update = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="comment">%         gram_matrix_update = inv(K_update+keps*eye(length(K_update)));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">    <span class="comment">% When the size of gram matrix reached a certain number,we use</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">    <span class="comment">% Sherman-Morrison formula to update the matrix which means we choose</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">    <span class="comment">% one row and column to be replaced by new data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">    <span class="keyword">if</span>(<span class="var type0" id="S21T0U62">gram_size</span> == <span class="var type0" id="S15T0U63">MAX_SIZE</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">        <span class="comment">% choose one row and column which has the highest covariance</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">        [~,<span class="var type0" id="S23T0U68">index</span>] = max(mean(<span class="var type0" id="S14T0U73">K</span>,1));</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">        <span class="comment">% K(:,index);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">        <span class="var type0" id="S12T0U78">X</span>(:,<span class="var type0" id="S23T0U80">index</span>) = <span class="var type0" id="S8T0U81">x</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">        <span class="var type0" id="S5T0U84">X_update</span> = <span class="var type0" id="S12T0U85">X</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">        <span class="var type0" id="S13T0U89">Y</span>(<span class="var type0" id="S23T0U90">index</span>,:) = <span class="var type0" id="S9T0U92">y</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">        <span class="var type0" id="S6T0U95">Y_update</span> = <span class="var type0" id="S13T0U96">Y</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">        <span class="var type0" id="S26T0U99">Ks</span> = <span class="var type0" id="S17T0U101">Kfn</span>(<span class="var type0" id="S5T0U102">X_update</span>,<span class="var type0" id="S8T0U103">x</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line">        <span class="var type0" id="S27T0U106">Ks_old</span> = <span class="var type0" id="S14T0U108">K</span>(:,<span class="var type0" id="S23T0U110">index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line"><span class="comment">%         K_old = K;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line">        <span class="var type0" id="S14T0U114">K</span>(:,<span class="var type0" id="S23T0U116">index</span>) = <span class="var type0" id="S26T0U117">Ks</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">        <span class="var type0" id="S14T0U121">K</span>(<span class="var type0" id="S23T0U122">index</span>,:) = <span class="var type0" id="S26T0U125">Ks</span>';</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line">        <span class="var type0" id="S7T0U128">K_update</span> = <span class="var type0" id="S14T0U129">K</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line">        <span class="var type0" id="S28T0U132">u</span> = zeros(<span class="var type0" id="S15T0U135">MAX_SIZE</span>,2);</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line">        <span class="var type0" id="S30T0U139">v</span> = zeros(<span class="var type0" id="S15T0U142">MAX_SIZE</span>,2);</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line">        <span class="var type0" id="S28T0U147">u</span>(<span class="var type0" id="S23T0U148">index</span>,1) = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line">        <span class="var type0" id="S28T0U154">u</span>(:,2) = <span class="var type0" id="S26T0U158">Ks</span> - <span class="var type0" id="S27T0U159">Ks_old</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line">        <span class="var type0" id="S28T0U163">u</span>(<span class="var type0" id="S23T0U164">index</span>,2) = <span class="var type0" id="S28T0U168">u</span>(<span class="var type0" id="S23T0U169">index</span>,2)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line">        <span class="var type0" id="S30T0U175">v</span>(:,1) = <span class="var type0" id="S28T0U179">u</span>(:,2);</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line">        <span class="var type0" id="S30T0U185">v</span>(:,2) = <span class="var type0" id="S28T0U189">u</span>(:,1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line">        <span class="var type0" id="S2T0U194">gram_matrix_update</span> = inverseUpdatePlus(<span class="var type0" id="S11T0U197">gram_matrix</span>,<span class="var type0" id="S28T0U198">u</span>,<span class="var type0" id="S30T0U199">v</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line">    <span class="comment">% otherwise we use block matrix property to update the matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line">        <span class="var type0" id="S26T0U203">Ks</span> = <span class="var type0" id="S17T0U205">Kfn</span>(<span class="var type0" id="S12T0U206">X</span>,<span class="var type0" id="S8T0U207">x</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line">        <span class="var type0" id="S32T0U210">b</span> = <span class="var type0" id="S26T0U211">Ks</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line">        <span class="var type0" id="S33T0U214">c</span> = 1+<span class="var type0" id="S20T0U217">keps</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line">        <span class="var type0" id="S2T0U220">gram_matrix_update</span> = inverseUpdate(<span class="var type0" id="S11T0U223">gram_matrix</span>,<span class="var type0" id="S32T0U224">b</span>,<span class="var type0" id="S33T0U225">c</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line">        <span class="var type0" id="S5T0U228">X_update</span> = [<span class="var type0" id="S12T0U231">X</span>,<span class="var type0" id="S8T0U232">x</span>];</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line">        <span class="var type0" id="S6T0U235">Y_update</span> = [<span class="var type0" id="S13T0U238">Y</span>;<span class="var type0" id="S9T0U240">y</span>];</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line">        <span class="var type0" id="S7T0U243">K_update</span> = [<span class="var type0" id="S14T0U246">K</span>,<span class="var type0" id="S26T0U247">Ks</span>;<span class="var type0" id="S26T0U250">Ks</span>',1];</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61">61</a></span><span class="line">    <span class="var type0" id="S35T0U254">Ks_star</span> = <span class="var type0" id="S17T0U256">Kfn</span>(<span class="var type0" id="S5T0U257">X_update</span>,<span class="var type0" id="S10T0U258">x_star</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62">62</a></span><span class="line">    <span class="var type0" id="S3T0U261">y_star</span> = <span class="var type0" id="S35T0U265">Ks_star</span>'*<span class="var type0" id="S2T0U266">gram_matrix_update</span>*<span class="var type0" id="S6T0U267">Y_update</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63">63</a></span><span class="line">    <span class="var type0" id="S4T0U270">cov_star</span> = 1 - <span class="var type0" id="S35T0U276">Ks_star</span>'*<span class="var type0" id="S2T0U277">gram_matrix_update</span>*<span class="var type0" id="S35T0U278">Ks_star</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64">64</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65">65</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66">66</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67">67</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68">68</a></span><span class="line"> </span></span>
</pre>
</div>
</body>
</html>
